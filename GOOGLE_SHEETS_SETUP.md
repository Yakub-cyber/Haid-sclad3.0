# Настройка Google Sheets API для React приложения

## 1. Настройка Google Cloud Console

### 1.1 Создание проекта

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Запомните ID проекта

### 1.2 Включение Google Sheets API

1. В меню слева выберите "APIs & Services" → "Library"
2. Найдите "Google Sheets API" и нажмите "Enable"

### 1.3 Создание API ключа

1. Перейдите в "APIs & Services" → "Credentials"
2. Нажмите "Create Credentials" → "API Key"
3. Скопируйте созданный ключ
4. Нажмите "Edit" на созданном ключе
5. В разделе "Application restrictions" выберите "HTTP referrers"
6. Добавьте домены вашего приложения:
   - `http://localhost:*` (для разработки)
   - `https://yourusername.github.io` (для GitHub Pages)
   - `https://*.github.io` (для всех GitHub Pages)

### 1.4 Настройка сервисного аккаунта (опционально)

Если нужен доступ к приватным таблицам:

1. В "Credentials" нажмите "Create Credentials" → "Service Account"
2. Заполните информацию о сервисном аккаунте
3. Скачайте JSON файл с ключами
4. Добавьте email сервисного аккаунта в доступ к таблице

## 2. Настройка Google Sheets

### 2.1 Публичный доступ (рекомендуется для начала)

1. Откройте вашу Google таблицу
2. Нажмите "Share" (в правом верхнем углу)
3. Нажмите "Change to anyone with the link"
4. Выберите "Viewer" для доступа только для чтения
5. Скопируйте ID таблицы из URL:
   ```
   https://docs.google.com/spreadsheets/d/1ecYUS0bEILKFANqXx3H0X7dLy-SoYiZo/edit
   ```
   ID: `1ecYUS0bEILKFANqXx3H0X7dLy-SoYiZo`

### 2.2 Доступ для сервисного аккаунта

Если используете сервисный аккаунт:

1. В настройках доступа добавьте email сервисного аккаунта
2. Дайте права "Viewer"

## 3. Настройка переменных окружения

### 3.1 Локальная разработка

Создайте файл `.env` в корне проекта:

```env
VITE_GOOGLE_SHEETS_API_KEY=ваш_api_ключ
VITE_SHEET_ID=1ecYUS0bEILKFANqXx3H0X7dLy-SoYiZo
VITE_SHEET_NAME=Лист1
```

### 3.2 GitHub Secrets

1. Перейдите в ваш репозиторий на GitHub
2. Нажмите "Settings" → "Secrets and variables" → "Actions"
3. Нажмите "New repository secret"
4. Добавьте следующие секреты:
   - `GOOGLE_SHEETS_API_KEY` = ваш API ключ
   - `SHEET_ID` = ID вашей таблицы
   - `SHEET_NAME` = название листа (обычно "Лист1")

## 4. Структура таблицы

Убедитесь, что ваша таблица имеет следующие колонки:

- `Наименование` - название товара
- `Опт` - оптовая цена
- `Розничный клиент` - розничная цена
- `Склад` - количество на складе
- `Постоянные клиенты` - цена для постоянных клиентов

## 5. Тестирование

### 5.1 Локальное тестирование

```bash
npm run dev
```

### 5.2 Тестирование API

```bash
curl "https://sheets.googleapis.com/v4/spreadsheets/YOUR_SHEET_ID/values/Лист1?key=YOUR_API_KEY"
```

## 6. Устранение неполадок

### 6.1 Ошибка CORS

- Убедитесь, что домен добавлен в ограничения API ключа
- Проверьте настройки прокси в `vite.config.js`

### 6.2 Ошибка доступа к таблице

- Проверьте права доступа к таблице
- Убедитесь, что ID таблицы правильный
- Проверьте название листа

### 6.3 Ошибка API ключа

- Проверьте правильность API ключа
- Убедитесь, что Google Sheets API включен
- Проверьте ограничения API ключа

## 7. Безопасность

⚠️ **Важно:**

- Никогда не коммитьте API ключи в репозиторий
- Используйте переменные окружения
- Ограничивайте доступ API ключа по доменам
- Регулярно ротируйте API ключи

## 8. Альтернативные методы

Если API не работает, приложение автоматически переключится на CSV экспорт:

```
https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/export?format=csv
```

Этот метод работает только для публичных таблиц.
